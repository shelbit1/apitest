// –ú–æ–¥—É–ª—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Excel –æ—Ç—á–µ—Ç–æ–≤
import * as XLSX from "xlsx";
import { cleanCampaignName, mapAdvertStatus, mapAdvertType, mapPaymentType, mapPaymentStatus } from './data-mappers';
import * as fs from "fs";
import * as path from "path";

// –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π
interface Campaign {
  advertId: number;
  name: string;
  type: number;
  status: number;
  dailyBudget: number;
  createTime: string;
  changeTime: string;
  startTime: string;
  endTime: string;
}

interface FinancialData {
  advertId: number;
  date: string;
  sum: number;
  bill: number;
  type: string;
  docNumber: string;
  sku?: string;
}

// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Excel –æ—Ç—á–µ—Ç–∞
export async function createExcelReport(
  data: any[], 
  storageData: any[], 
  acceptanceData: any[], 
  advertData: any[], 
  productsData: any[], 
  paymentsData: any[], 
  campaigns: Campaign[], 
  financialData: FinancialData[], 
  costPriceData: any[], 
  productAnalyticsData: any[], 
  startDate: string, 
  endDate: string, 
  token: string, 
  includeFinanceSheet: boolean = false
): Promise<Buffer> {
  const startTime = Date.now();
  console.log("üöÄ –ù–∞—á–∏–Ω–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ Excel –æ—Ç—á–µ—Ç–∞...");
  
  // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è Excel
  const excelData = data.map((item) => ({
    "–ù–æ–º–µ—Ä –ø–æ—Å—Ç–∞–≤–∫–∏": item.gi_id || "",
    "–ê—Ä—Ç–∏–∫—É–ª WB": item.nm_id || "",
    "–ê—Ä—Ç–∏–∫—É–ª –ø—Ä–æ–¥–∞–≤—Ü–∞": item.sa_name || "",
    "–ë–∞—Ä–∫–æ–¥": item.barcode || "",
    "–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞": item.doc_type_name || "",
    "–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ–ø–ª–∞—Ç—ã": item.supplier_oper_name || "",
    "–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞": item.order_dt || "",
    "–î–∞—Ç–∞ –ø—Ä–æ–¥–∞–∂–∏": item.sale_dt || "",
    "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ": item.quantity || 0,
    "–¶–µ–Ω–∞ —Ä–æ–∑–Ω–∏—á–Ω–∞—è —Å —É—á–µ—Ç–æ–º —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–π —Å–∫–∏–¥–∫–∏": item.retail_price_withdisc_rub || 0,
    "–í–∞–π–ª–¥–±–µ—Ä—Ä–∏–∑ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª –¢–æ–≤–∞—Ä (–ü—Ä)": item.retail_amount || 0,
    "–ö –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—é –ø—Ä–æ–¥–∞–≤—Ü—É": item.ppvz_for_pay || 0,
    "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç–∞–≤–æ–∫": item.delivery_amount || 0,
    "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤": item.return_amount || 0,
    "–£—Å–ª—É–≥–∏ –ø–æ –¥–æ—Å—Ç–∞–≤–∫–µ —Ç–æ–≤–∞—Ä–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª—é": item.delivery_rub || 0,
    "–û–±—â–∞—è —Å—É–º–º–∞ —à—Ç—Ä–∞—Ñ–æ–≤": item.penalty || 0,
    "–î–æ–ø–ª–∞—Ç—ã": item.additional_payment || 0,
    "–í–∏–¥—ã –ª–æ–≥–∏—Å—Ç–∏–∫–∏, —à—Ç—Ä–∞—Ñ–æ–≤ –∏ –¥–æ–ø–ª–∞—Ç": item.bonus_type_name || "",
    "–°–∫–ª–∞–¥": item.office_name || "",
    "–°—Ç—Ä–∞–Ω–∞": item.site_country || "",
    "–¢–∏–ø –∫–æ—Ä–æ–±–æ–≤": item.gi_box_type_name || "",
    "–ù–æ–º–µ—Ä —Ç–∞–º–æ–∂–µ–Ω–Ω–æ–π –¥–µ–∫–ª–∞—Ä–∞—Ü–∏–∏": item.declaration_number || "",
    "–ù–æ–º–µ—Ä —Å–±–æ—Ä–æ—á–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è": item.assembly_id || "",
    "–ö–æ–¥ –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏": item.kiz || "",
    "–®—Ç—Ä–∏—Ö–∫–æ–¥": item.shk_id || "",
    "Srid": item.srid || "",
    "–í–æ–∑–º–µ—â–µ–Ω–∏–µ –∏–∑–¥–µ—Ä–∂–µ–∫ –ø–æ –ø–µ—Ä–µ–≤–æ–∑–∫–µ": item.rebill_logistic_cost || 0,
    "–•—Ä–∞–Ω–µ–Ω–∏–µ": item.storage_fee || 0,
    "–£–¥–µ—Ä–∂–∞–Ω–∏—è": item.deduction || 0,
    "–ü–ª–∞—Ç–Ω–∞—è –ø—Ä–∏–µ–º–∫–∞": item.acceptance || 0,
    "–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞ (—Ç–æ–ª—å–∫–æ –¥–∞—Ç–∞)": item.order_dt ? item.order_dt.split('T')[0] : "",
    "–î–∞—Ç–∞ –ø—Ä–æ–¥–∞–∂–∏ (—Ç–æ–ª—å–∫–æ –¥–∞—Ç–∞)": item.sale_dt ? item.sale_dt.split('T')[0] : "",
  }));

  console.log(`‚è±Ô∏è –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∑–∞ ${Date.now() - startTime}ms`);
  
  // –°–æ–∑–¥–∞–µ–º —Ä–∞–±–æ—á—É—é –∫–Ω–∏–≥—É
  const workbook = XLSX.utils.book_new();
  
  // –°–æ–∑–¥–∞–µ–º –ª–∏—Å—Ç –∏–∑ –¥–∞–Ω–Ω—ã—Ö
  const worksheet = XLSX.utils.json_to_sheet(excelData);
  
  // –î–æ–±–∞–≤–ª—è–µ–º –ª–∏—Å—Ç –≤ –∫–Ω–∏–≥—É
  XLSX.utils.book_append_sheet(workbook, worksheet, "–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏");
  
  // –î–æ–±–∞–≤–ª—è–µ–º –ª–∏—Å—Ç "–ü–æ –ø–µ—Ä–∏–æ–¥–∞–º"
  addPeriodsSheet(workbook, startDate, endDate);
  
  // –î–æ–±–∞–≤–ª—è–µ–º –ª–∏—Å—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è
  if (storageData.length > 0) {
    addStorageSheet(workbook, storageData);
  }
  
  // –î–æ–±–∞–≤–ª—è–µ–º –ª–∏—Å—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–∏–µ–º–∫–∏
  if (acceptanceData.length > 0) {
    addAcceptanceSheet(workbook, acceptanceData);
  }
  
  // –î–æ–±–∞–≤–ª—è–µ–º –ª–∏—Å—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–æ–≤
  if (productsData.length > 0) {
    addProductsSheet(workbook, productsData);
  }
  
  // –î–æ–±–∞–≤–ª—è–µ–º –ª–∏—Å—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–ª–∞—Ç–µ–∂–µ–π
  if (paymentsData.length > 0) {
    addPaymentsSheet(workbook, paymentsData);
  }
  
  // –î–æ–±–∞–≤–ª—è–µ–º –ª–∏—Å—Ç —Å —Ä–µ–∫–ª–∞–º–Ω—ã–º–∏ –∫–∞–º–ø–∞–Ω–∏—è–º–∏
  if (campaigns.length > 0) {
    addCampaignsSheet(workbook, campaigns);
  }
  
  // –î–æ–±–∞–≤–ª—è–µ–º –ª–∏—Å—Ç —Å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –†–ö (–µ—Å–ª–∏ –∑–∞–ø—Ä–æ—à–µ–Ω)
  if (includeFinanceSheet && financialData.length > 0) {
    addFinancialSheet(workbook, financialData);
  }
  
  // –î–æ–±–∞–≤–ª—è–µ–º –ª–∏—Å—Ç —Å —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å—é
  if (costPriceData.length > 0) {
    addCostPriceSheet(workbook, costPriceData);
  }
  
  // –î–æ–±–∞–≤–ª—è–µ–º –ª–∏—Å—Ç —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π —Ç–æ–≤–∞—Ä–æ–≤
  if (productAnalyticsData.length > 0) {
    addProductAnalyticsSheet(workbook, productAnalyticsData);
  }
  
  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º Excel —Ñ–∞–π–ª
  const buffer = XLSX.write(workbook, { type: "buffer", bookType: "xlsx" });
  
  console.log(`‚úÖ Excel –æ—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω –∑–∞ ${Date.now() - startTime}ms`);
  
  return buffer;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ª–∏—Å—Ç–∞ —Å –ø–µ—Ä–∏–æ–¥–∞–º–∏ (—Ç–æ—á–Ω–∞—è –∫–æ–ø–∏—è –∏–∑ Google —Ç–∞–±–ª–∏—Ü—ã)
export function addPeriodsSheet(workbook: XLSX.WorkBook, startDate: string, endDate: string) {
  console.log("üìä –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏—Å—Ç–∞ '–ü–æ –ø–µ—Ä–∏–æ–¥–∞–º'...");
  const periodsSheet = XLSX.utils.aoa_to_sheet([
    // –°—Ç—Ä–æ–∫–∏ 1-2: –ü–µ—Ä–∏–æ–¥ –¥–∞—Ç
    ['–æ—Ç', startDate],
    ['–¥–æ', endDate],
    [''],
    ['------------------------------------------'],
    [''],
    
    // –°—Ç—Ä–æ–∫–∞ 6: –ó–∞–≥–æ–ª–æ–≤–æ–∫
    ['–î–≤–∏–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ —à—Ç—É–∫–∞—Ö'],
    // –°—Ç—Ä–æ–∫–∏ 7-19: –î–≤–∏–∂–µ–Ω–∏–µ –≤ —à—Ç—É–∫–∞—Ö
    ['–î–æ—Å—Ç–∞–≤–∫–∏', { f: "SUMIF('–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!M:M,\">0\",'–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!M:M)", z: '#,##0.00' }],
    ['–û—Ç–∫–∞–∑—ã –±–µ–∑ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤', 
     { f: "SUMIF('–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!R:R,\"–û—Ç –∫–ª–∏–µ–Ω—Ç–∞ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ\",'–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!N:N)", z: '#,##0.00' },
     '–û—Ç –∫–ª–∏–µ–Ω—Ç–∞ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ'],
    ['% –æ—Ç–∫–∞–∑–æ–≤', { f: "B8/B7", z: '0.00%' }],
    [''],
    ['–ü—Ä–æ–¥–∞–∂–∏',
     { f: "SUMIF('–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!E:E,\"–ü—Ä–æ–¥–∞–∂–∞\",'–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!I:I)", z: '#,##0.00' },
     '–ü—Ä–æ–¥–∞–∂–∞'],
    ['–í–æ–∑–≤—Ä–∞—Ç—ã',
     { f: "SUMIF('–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!E:E,\"–í–æ–∑–≤—Ä–∞—Ç\",'–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!I:I)", z: '#,##0.00' },
     '–í–æ–∑–≤—Ä–∞—Ç'],
    ['% –≤–æ–∑–≤—Ä–∞—Ç–æ–≤', { f: "B12/B11", z: '0.00%' }],
    [''],
    ['–ò—Ç–æ–≥–æ –∫–æ–ª-–≤–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞', { f: "B11-B12", z: '#,##0.00' }],
    ['% –≤—ã–∫—É–ø–∞', { f: "B15/B7", z: '0.00%' }],
    [''],
    ['–ü—Ä–æ–¥–∞–∂–∏ + –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏',
     { f: "SUMIF('–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!E:E,\"–ü—Ä–æ–¥–∞–∂–∞\",'–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!I:I)", z: '#,##0.00' },
     '–ü—Ä–æ–¥–∞–∂–∞'],
    ['–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –≤ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–∏ –∑–∞ —Ç–æ–≤–∞—Ä —à—Ç',
     { f: "SUMIF('–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!F:F,\"–î–æ–±—Ä–æ–≤–æ–ª—å–Ω–∞—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ\",'–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!I:I)", z: '#,##0.00' },
     '–î–æ–±—Ä–æ–≤–æ–ª—å–Ω–∞—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ'],
    [''],
    ['------------------------------------------'],
    [''],
    
    // –°—Ç—Ä–æ–∫–∞ 23: –î–≤–∏–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ —Ä—É–±–ª—è—Ö –¥–æ –°–ü–ü
    ['–î–≤–∏–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ —Ä—É–±–ª—è—Ö –ø–æ —Ü–µ–Ω–µ –ø—Ä–æ–¥–∞–≤—Ü–∞ —Å —É—á–µ—Ç–æ–º —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–π —Å–∫–∏–¥–∫–∏ (–¥–æ –°–ü–ü)'],
    ['–ü—Ä–æ–¥–∞–∂–∏ –¥–æ –°–ü–ü', 
     { f: "SUMIF('–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!E:E,\"–ü—Ä–æ–¥–∞–∂–∞\",'–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!J:J)", z: '#,##0.00' },
     '–ü—Ä–æ–¥–∞–∂–∞'],
    ['–í–æ–∑–≤—Ä–∞—Ç—ã –¥–æ –°–ü–ü',
     { f: "SUMIF('–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!E:E,\"–í–æ–∑–≤—Ä–∞—Ç\",'–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!J:J)", z: '#,##0.00' },
     '–í–æ–∑–≤—Ä–∞—Ç'],
    ['–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –≤ –ø—Ä–æ–¥–∞–∂–∞—Ö –¥–æ –°–ü–ü', { v: 0, z: '#,##0.00' }],
         ['–í—Å—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –¥–æ –°–ü–ü', { f: "B24-B25", z: '#,##0.00' }],
     ['–°—Ä–µ–¥–Ω–∏–π —á–µ–∫ –ø—Ä–æ–¥–∞–∂–∏ –¥–æ –°–ü–ü', { f: "B27/B15", z: '#,##0.00' }],
    ['% –∫–æ–º–∏—Å—Å–∏–∏ –í–ë –¥–æ –°–ü–ü', { f: "(B24-B34)/B24", z: '0.00%' }],
    [''],
    ['------------------------------------------'],
    [''],
    
    // –°—Ç—Ä–æ–∫–∞ 33: –î–≤–∏–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ —Ä—É–±–ª—è—Ö –ø–æ—Å–ª–µ –°–ü–ü
    ['–î–≤–∏–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ —Ä—É–±–ª—è—Ö –ø–æ —Ü–µ–Ω–µ —Å —É—á–µ—Ç–æ–º —Å–∫–∏–¥–∫–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è (–ø–æ—Å–ª–µ –°–ü–ü)'],
    ['–ü—Ä–æ–¥–∞–∂–∏ –ø–æ—Å–ª–µ –°–ü–ü',
     { f: "SUMIF('–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!E:E,\"–ü—Ä–æ–¥–∞–∂–∞\",'–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!L:L)", z: '#,##0.00' },
     '–ü—Ä–æ–¥–∞–∂–∞'],
    ['–í–æ–∑–≤—Ä–∞—Ç—ã –ø–æ—Å–ª–µ –°–ü–ü',
     { f: "SUMIF('–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!E:E,\"–í–æ–∑–≤—Ä–∞—Ç\",'–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!L:L)", z: '#,##0.00' },
     '–í–æ–∑–≤—Ä–∞—Ç'],
    ['–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –≤ –ø—Ä–æ–¥–∞–∂–∞—Ö –ø–æ—Å–ª–µ –°–ü–ü', { v: 0, z: '#,##0.00' }, '–ö–æ—Ä—Ä–µ–∫—Ü–∏—è –ø—Ä–æ–¥–∞–∂'],
    ['–í—Å—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –°–ü–ü', { f: "B34-B35", z: '#,##0.00' }],
    ['–°—Ä–µ–¥–Ω–∏–π —á–µ–∫ –ø—Ä–æ–¥–∞–∂–∏ –ø–æ—Å–ª–µ –°–ü–ü', { f: "B34/B11", z: '#,##0.00' }],
         ['–°—É–º–º–∞ –°–ü–ü', { f: "B24-B34", z: '#,##0.00' }],
     ['% –°–ü–ü', { f: "1-B38/B28", z: '0.00%' }],
    [''],
    ['------------------------------------------'],
    [''],
    
    // –°—Ç—Ä–æ–∫–∞ 44: –ö –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—é –∑–∞ —Ç–æ–≤–∞—Ä
    ['–ö –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—é –∑–∞ —Ç–æ–≤–∞—Ä'],
    ['–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –≤ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–∏ –∑–∞ —Ç–æ–≤–∞—Ä',
     { f: "SUMIF('–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!F:F,\"–î–æ–±—Ä–æ–≤–æ–ª—å–Ω–∞—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ\",'–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!L:L)", z: '#,##0.00' },
     '–î–æ–±—Ä–æ–≤–æ–ª—å–Ω–∞—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ'],
    ['–ü—Ä–æ–¥–∞–∂–∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ (—Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ - –∫–æ–º–∏—Å—Å–∏—è –í–ë)',
     { f: "SUMIF('–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!E:E,\"–ü—Ä–æ–¥–∞–∂–∞\",'–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!L:L)", z: '#,##0.00' },
     '–ü—Ä–æ–¥–∞–∂–∞'],
    ['–í–æ–∑–≤—Ä–∞—Ç—ã –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –ø–æ —Ñ–∞–∫—Ç—É –∑–∞ –≤–æ–∑–≤—Ä–∞—Ç –ø–æ —Ñ–æ—Ä–º—É–ª–µ (–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ - –∫–æ–º–∏—Å—Å–∏—è –í–ë)',
     { f: "SUMIF('–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!E:E,\"–í–æ–∑–≤—Ä–∞—Ç\",'–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!L:L)", z: '#,##0.00' },
     '–í–æ–∑–≤—Ä–∞—Ç'],
    ['–ö –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—é –∑–∞ —Ç–æ–≤–∞—Ä', { f: "B46-B47", z: '#,##0.00' }],
    [''],
    ['------------------------------------------'],
    [''],
    
    // –°—Ç—Ä–æ–∫–∞ 52: –°—Ç–∞—Ç—å–∏ —É–¥–µ—Ä–∂–∞–Ω–∏–π –í–∞–π–ª–¥–±–µ—Ä—Ä–∏–∑
    ['–°—Ç–∞—Ç—å–∏ —É–¥–µ—Ä–∂–∞–Ω–∏–π –í–∞–π–ª–¥–±–µ—Ä—Ä–∏–∑'],
    ['–ü–ª–∞–Ω–æ–≤–∞—è –∫–æ–º–∏—Å—Å–∏—è + —ç–∫–≤–∞–π—Ä–∏–Ω–≥', { f: "B24-B48", z: '#,##0.00' }],
    ['–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è', { f: "B34-B48", z: '#,##0.00' }],
    ['–°—Ç–æ–∏–º–æ—Å—Ç—å –ª–æ–≥–∏—Å—Ç–∏–∫–∏',
     { f: "SUM('–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!O:O)", z: '#,##0.00' }],
    ['–õ–æ–≥–∏—Å—Ç–∏–∫–∞ –Ω–∞ –µ–¥–∏–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞', { f: "B55/B15", z: '#,##0.00' }],
    ['% –ª–æ–≥–∏—Å—Ç–∏–∫–∏ –æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–æ –°–ü–ü', { f: "B55/B24", z: '0.00%' }],
    ['–®—Ç—Ä–∞—Ñ—ã',
     { f: "SUM('–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!P:P)", z: '#,##0.00' }],
    ['–î–æ–ø–ª–∞—Ç—ã', { v: 0, z: '#,##0.00' }],
    ['–•—Ä–∞–Ω–µ–Ω–∏–µ',
     { f: "SUM('–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!AB:AB)", z: '#,##0.00' }],
    ['% —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–æ –°–ü–ü', { f: "B60/B24", z: '0.00%' }],
    ['–ü–ª–∞—Ç–Ω–∞—è –ø—Ä–∏–µ–º–∫–∞',
     { f: "SUM('–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!AD:AD)", z: '#,##0.00' }],
    [''],
    ['"–†–µ–∫–ª–∞–º–∞ –±–∞–ª–∞–Ω—Å + —Å—á–µ—Ç"',
     { f: "SUMIF('–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!R:R,\"–û–∫–∞–∑–∞–Ω–∏–µ —É—Å–ª—É–≥ ¬´–í–ë.–ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ¬ª\",'–û—Ç—á–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏'!AC:AC)", z: '#,##0.00' },
     '–û–∫–∞–∑–∞–Ω–∏–µ —É—Å–ª—É–≥ ¬´–í–ë.–ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ¬ª'],
    ['% –î–†–† (–¥–æ–ª—è —Ä–µ–∫–ª–∞–º–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤) –æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–æ –°–ü–ü', { f: "B63/B15", z: '#,##0.00' }],
    ['% –î–†–† (–¥–æ–ª—è —Ä–µ–∫–ª–∞–º–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤) –æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–æ –°–ü–ü', { f: "B63/B24", z: '0.00%' }],
    [''],
    ['–ò–ú–ò–ó–† (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ—Ö–∞–Ω–∏–∫ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∑–∞–≤—ã—à–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞)', { v: 0, z: '#,##0.00' }],
    [''],
    ['–û—Ç–∑—ã–≤—ã', { v: 0, z: '#,##0.00' }, '–°–ø–∏—Å–∞–Ω–∏–µ –∑–∞ –æ—Ç–∑—ã–≤'],
    ['–ö—Ä–µ–¥–∏—Ç', { f: "B69+B70", z: '#,##0.00' }],
    ['–¢–µ–ª–æ –∫—Ä–µ–¥–∏—Ç–∞', { f: "B69*0.82", z: '#,##0.00' }],
    ['–ü—Ä–æ—Ü–µ–Ω—Ç –∫—Ä–µ–¥–∏—Ç–∞', { f: "B69*0.18", z: '#,##0.00' }],
    ['% –∫—Ä–µ–¥–∏—Ç–∞ –æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–æ –°–ü–ü', { f: "B69/B24", z: '0.00%' }],
    ['–ü—Ä–æ—á–∏–µ —É–¥–µ—Ä–∂–∞–Ω–∏—è', { v: 0, z: '#,##0.00' }],
    ['% –ø—Ä–æ—á–∏—Ö —É–¥–µ—Ä–∂–∞–Ω–∏–π –æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–æ –°–ü–ü', { f: "B73/B24", z: '0.00%' }],
    ['–ò—Ç–æ–≥–æ —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—Å–µ—Ö —É—Å–ª—É–≥ –í–ë –æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–æ –°–ü–ü',
     { f: "B55+B58+B60+B62+B63+B67+B69+B73", z: '#,##0.00' }],
    ['% –≤—Å–µ—Ö —É—Å–ª—É–≥ –í–ë –æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–æ –°–ü–ü', { f: "B75/B24", z: '0.00%' }],
    ['–ò—Ç–æ–≥–æ —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—Å–µ—Ö —É—Å–ª—É–≥ –í–ë –æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –°–ü–ü', { f: "B55+B60", z: '#,##0.00' }],
    ['% –≤—Å–µ—Ö —É—Å–ª—É–≥ –í–ë –æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –°–ü–ü', { f: "B77/B37", z: '0.00%' }],
    [''],
    ['------------------------------------------'],
    [''],
    
    // –°—Ç—Ä–æ–∫–∞ 81: –ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—á–µ—Ç–æ–≤
    ['–ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—á–µ—Ç–æ–≤'],
    ['–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ', { f: "B48", z: '#,##0.00' }],
    ['–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ –Ω–∞ –µ–¥–∏–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞', { f: "B82/B15", z: '#,##0.00' }],
    [''],
    ['------------------------------------------'],
    [''],
    
    // –°—Ç—Ä–æ–∫–∞ 87: –ü—Ä—è–º—ã–µ —Ä–∞—Å—Ö–æ–¥—ã
    ['–ü—Ä—è–º—ã–µ —Ä–∞—Å—Ö–æ–¥—ã'],
    ['–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞', { f: "B15*700", z: '#,##0.00' }],
    ['% —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—É–º–º—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–æ –°–ü–ü', { f: "B88/B24", z: '0.00%' }],
    ['–°—Ä–µ–¥–Ω—è—è —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞ –µ–¥–∏–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞', { f: "B88/B15", z: '#,##0.00' }],
    ['–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å —É—Ç–∏–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞', { v: 0, z: '#,##0.00' }],
    [''],
    ['------------------------------------------'],
    [''],
    
    // –°—Ç—Ä–æ–∫–∞ 95: –ò—Ç–æ–≥–∏
    ['–ò—Ç–æ–≥–∏'],
    ['–ü—Ä–∏–±—ã–ª—å –ú–ü (–±–µ–∑ –≤–Ω–µ—à–∫–∏)', { f: "B82-B88", z: '#,##0.00' }],
    ['–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –ø—Ä–∏–±—ã–ª—å –ú–ü –Ω–∞ –µ–¥–∏–Ω–∏—Ü—É', { f: "B96/B15", z: '#,##0.00' }],
    ['–ú–∞—Ä–∂–∞ –¥–æ –°–ü–ü', { f: "B96/B24", z: '0.00%' }],
    ['–ú–∞—Ä–∂–∞ –ø–æ—Å–ª–µ –°–ü–ü', { f: "B96/B37", z: '0.00%' }],
    ['–†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å', { f: "B96/B88", z: '0.00%' }],
  ]);
  
  XLSX.utils.book_append_sheet(workbook, periodsSheet, "–ü–æ –ø–µ—Ä–∏–æ–¥–∞–º");
  console.log("‚úÖ –õ–∏—Å—Ç '–ü–æ –ø–µ—Ä–∏–æ–¥–∞–º' —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ");
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ª–∏—Å—Ç–∞ —Å –ø–µ—Ä–∏–æ–¥–∞–º–∏ –∏–∑ —à–∞–±–ª–æ–Ω–∞
export function addPeriodsSheetFromTemplate(workbook: XLSX.WorkBook, templatePath: string, startDate: string, endDate: string): boolean {
  console.log(`üìä –ü–æ–ø—ã—Ç–∫–∞ –¥–æ–±–∞–≤–∏—Ç—å –ª–∏—Å—Ç '–ü–æ –ø–µ—Ä–∏–æ–¥–∞–º' –∏–∑ —à–∞–±–ª–æ–Ω–∞: ${templatePath}`);
  try {
    const templateWorkbook = XLSX.readFile(templatePath, { cellFormula: true, cellNF: true, cellStyles: true });
    const templateSheet = templateWorkbook.Sheets["–ü–æ –ø–µ—Ä–∏–æ–¥–∞–º"];
    if (templateSheet) {
      // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–ø–∏—é –ª–∏—Å—Ç–∞ –≤ –Ω–æ–≤—É—é –∫–Ω–∏–≥—É
      const sheetCopy: XLSX.WorkSheet = JSON.parse(JSON.stringify(templateSheet));
      // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞—Ç—ã –ø–µ—Ä–∏–æ–¥–∞ –≤ —è—á–µ–π–∫–∞—Ö B1 –∏ B2, –µ—Å–ª–∏ –æ–Ω–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
      const startCell = sheetCopy["B1"];
      if (startCell) startCell.v = startDate;
      const endCell = sheetCopy["B2"];
      if (endCell) endCell.v = endDate;
      XLSX.utils.book_append_sheet(workbook, sheetCopy, "–ü–æ –ø–µ—Ä–∏–æ–¥–∞–º");
      console.log("‚úÖ –õ–∏—Å—Ç '–ü–æ –ø–µ—Ä–∏–æ–¥–∞–º' –¥–æ–±–∞–≤–ª–µ–Ω –∏–∑ —à–∞–±–ª–æ–Ω–∞");
      return true;
    } else {
      console.warn(`‚ö†Ô∏è –õ–∏—Å—Ç \"–ü–æ –ø–µ—Ä–∏–æ–¥–∞–º\" –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —à–∞–±–ª–æ–Ω–µ –ø–æ –ø—É—Ç–∏: ${templatePath}`);
      return false;
    }
  } catch (error) {
    console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –¥–æ–±–∞–≤–∏—Ç—å –ª–∏—Å—Ç '–ü–æ –ø–µ—Ä–∏–æ–¥–∞–º' –∏–∑ —à–∞–±–ª–æ–Ω–∞:`, error);
    return false;
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ª–∏—Å—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è
function addStorageSheet(workbook: XLSX.WorkBook, storageData: any[]) {
  const storageSheet = XLSX.utils.json_to_sheet(storageData.map(item => ({
    "–ê—Ä—Ç–∏–∫—É–ª WB": item.nmId || "",
    "–ê—Ä—Ç–∏–∫—É–ª –ø—Ä–æ–¥–∞–≤—Ü–∞": item.vendorCode || "",
    "–°–∫–ª–∞–¥": item.warehouseName || "",
    "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ": item.quantity || 0,
    "–¶–µ–Ω–∞": item.price || 0,
    "–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è": item.lastChangeDate || "",
    "–ë–∞—Ä–∫–æ–¥": item.barcode || "",
    "–ü—Ä–µ–¥–º–µ—Ç": item.subject || "",
    "–ö–∞—Ç–µ–≥–æ—Ä–∏—è": item.category || "",
    "–ë—Ä–µ–Ω–¥": item.brand || ""
  })));
  
  XLSX.utils.book_append_sheet(workbook, storageSheet, "–•—Ä–∞–Ω–µ–Ω–∏–µ");
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ª–∏—Å—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–∏–µ–º–∫–∏
function addAcceptanceSheet(workbook: XLSX.WorkBook, acceptanceData: any[]) {
  const acceptanceSheet = XLSX.utils.json_to_sheet(acceptanceData.map(item => ({
    "–ù–æ–º–µ—Ä –ø–æ—Å—Ç–∞–≤–∫–∏": item.incomeId || "",
    "–ê—Ä—Ç–∏–∫—É–ª WB": item.nmId || "",
    "–ê—Ä—Ç–∏–∫—É–ª –ø—Ä–æ–¥–∞–≤—Ü–∞": item.vendorCode || "",
    "–ë–∞—Ä–∫–æ–¥": item.barcode || "",
    "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ": item.quantity || 0,
    "–¶–µ–Ω–∞": item.totalPrice || 0,
    "–î–∞—Ç–∞ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è": item.dateClose || "",
    "–°–∫–ª–∞–¥": item.warehouseName || "",
    "–°—Ç–∞—Ç—É—Å": item.status || ""
  })));
  
  XLSX.utils.book_append_sheet(workbook, acceptanceSheet, "–ü—Ä–∏–µ–º–∫–∞");
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ª–∏—Å—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–æ–≤
function addProductsSheet(workbook: XLSX.WorkBook, productsData: any[]) {
  const productsSheet = XLSX.utils.json_to_sheet(productsData.map(item => ({
    "–ê—Ä—Ç–∏–∫—É–ª WB": item.nmId || "",
    "–ê—Ä—Ç–∏–∫—É–ª –ø—Ä–æ–¥–∞–≤—Ü–∞": item.vendorCode || "",
    "–ü—Ä–µ–¥–º–µ—Ç": item.object || "",
    "–ë—Ä–µ–Ω–¥": item.brand || "",
    "–ù–∞–∑–≤–∞–Ω–∏–µ": item.title || "",
    "–§–æ—Ç–æ": item.photo || "",
    "–†–∞–∑–º–µ—Ä—ã": item.dimensions || "",
    "–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏": item.characteristics || "",
    "–¶–µ–Ω–∞": item.price || 0,
    "–°–∫–∏–¥–∫–∞": item.discount || 0,
    "–†–µ–π—Ç–∏–Ω–≥": item.rating || 0,
    "–û—Ç–∑—ã–≤—ã": item.reviewsCount || 0
  })));
  
  XLSX.utils.book_append_sheet(workbook, productsSheet, "–¢–æ–≤–∞—Ä—ã");
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ª–∏—Å—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–ª–∞—Ç–µ–∂–µ–π
function addPaymentsSheet(workbook: XLSX.WorkBook, paymentsData: any[]) {
  const paymentsSheet = XLSX.utils.json_to_sheet(paymentsData.map(item => ({
    "–ù–æ–º–µ—Ä –æ–ø–µ—Ä–∞—Ü–∏–∏": item.operationId || "",
    "–î–∞—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏": item.date || "",
    "–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏": item.type || "",
    "–°—É–º–º–∞": item.amount || 0,
    "–ë–∞–ª–∞–Ω—Å": item.balance || 0,
    "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π": item.comment || "",
    "–¢–∏–ø –ø–ª–∞—Ç–µ–∂–∞": mapPaymentType(item.paymentType || 0),
    "–°—Ç–∞—Ç—É—Å": mapPaymentStatus(item.status || 0)
  })));
  
  XLSX.utils.book_append_sheet(workbook, paymentsSheet, "–ü–ª–∞—Ç–µ–∂–∏");
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ª–∏—Å—Ç–∞ —Å —Ä–µ–∫–ª–∞–º–Ω—ã–º–∏ –∫–∞–º–ø–∞–Ω–∏—è–º–∏
function addCampaignsSheet(workbook: XLSX.WorkBook, campaigns: Campaign[]) {
  const campaignsSheet = XLSX.utils.json_to_sheet(campaigns.map(item => ({
    "ID –∫–∞–º–ø–∞–Ω–∏–∏": item.advertId || "",
    "–ù–∞–∑–≤–∞–Ω–∏–µ": cleanCampaignName(item.name || ""),
    "–¢–∏–ø": mapAdvertType(item.type || 0),
    "–°—Ç–∞—Ç—É—Å": mapAdvertStatus(item.status || 0),
    "–î–Ω–µ–≤–Ω–æ–π –±—é–¥–∂–µ—Ç": item.dailyBudget || 0,
    "–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è": item.createTime || "",
    "–î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è": item.changeTime || "",
    "–î–∞—Ç–∞ –∑–∞–ø—É—Å–∫–∞": item.startTime || "",
    "–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è": item.endTime || ""
  })));
  
  XLSX.utils.book_append_sheet(workbook, campaignsSheet, "–ö–∞–º–ø–∞–Ω–∏–∏");
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ª–∏—Å—Ç–∞ —Å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –†–ö
function addFinancialSheet(workbook: XLSX.WorkBook, financialData: FinancialData[]) {
  const financialSheet = XLSX.utils.json_to_sheet(financialData.map(item => ({
    "ID –∫–∞–º–ø–∞–Ω–∏–∏": item.advertId || "",
    "–î–∞—Ç–∞": item.date || "",
    "–°—É–º–º–∞": item.sum || 0,
    "–°—á–µ—Ç": item.bill ? "–î–∞" : "–ù–µ—Ç",
    "–¢–∏–ø": item.type || "",
    "–ù–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞": item.docNumber || "",
    "SKU": item.sku || ""
  })));
  
  XLSX.utils.book_append_sheet(workbook, financialSheet, "–§–∏–Ω–∞–Ω—Å—ã –†–ö");
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ª–∏—Å—Ç–∞ —Å —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å—é
function addCostPriceSheet(workbook: XLSX.WorkBook, costPriceData: any[]) {
  const costPriceSheet = XLSX.utils.json_to_sheet(costPriceData.map(item => ({
    "–ê—Ä—Ç–∏–∫—É–ª –ø—Ä–æ–¥–∞–≤—Ü–∞": item.vendorCode || "",
    "–ù–∞–∑–≤–∞–Ω–∏–µ": item.name || "",
    "–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å": item.costPrice || 0,
    "–í–∞–ª—é—Ç–∞": item.currency || "RUB",
    "–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è": item.lastUpdated || ""
  })));
  
  XLSX.utils.book_append_sheet(workbook, costPriceSheet, "–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å");
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ª–∏—Å—Ç–∞ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π —Ç–æ–≤–∞—Ä–æ–≤
function addProductAnalyticsSheet(workbook: XLSX.WorkBook, productAnalyticsData: any[]) {
  const analyticsSheet = XLSX.utils.json_to_sheet(productAnalyticsData);
  XLSX.utils.book_append_sheet(workbook, analyticsSheet, "–ê–Ω–∞–ª–∏—Ç–∏–∫–∞");
} 